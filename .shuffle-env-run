#!/bin/sh

: "${CANONICAL_CHARACTER_REPO:=github.com/philpennock/character}"

repo="$(pwd)"

case $repo in
  */"src/${CANONICAL_CHARACTER_REPO}")
    # all good
    true
    ;;
  *)
    printf >&2 "%s: %s\n" "$(basename "$0")" "not inside a GOPATH setup"
    exit 1
    ;;
esac

GOPATH="${repo%/src/${CANONICAL_CHARACTER_REPO}}"
export GOPATH
PATH="$GOPATH/bin:$PATH"
export PATH

if [ "${1:-.}" = "show" ]; then
	echo "GOPATH=\"$GOPATH\"; export GOPATH;"
	# if bad characters already in PATH, this may result in the eval'ing
	# caller performing shell code via bad environ.  If someone can control
	# $PATH then security is already compromised and there's no further
	# issue here.
	echo "PATH=\"$PATH\"; export PATH;"
else
	"$@"
fi
